<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reflectory — Mentorship & AI-assisted Guidance</title>
  <meta name="description" content="Reflectory: Student-first mentorship for career clarity, habits, and AI-assisted planning." />
  <style>
    :root{
      --bg:#071326;--card:#0b1220;--accent:#6c7cff;--muted:#9aa4c0;--glass: rgba(255,255,255,0.03);--radius:12px;--max-width:1000px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#071028 0%, #071326 100%);color:#e6eef8}
    .container{max-width:var(--max-width);margin:0 auto;padding:20px}
    header{position:sticky;top:0;background:rgba(255,255,255,0.01);border-bottom:1px solid rgba(255,255,255,0.03);z-index:40}
    header .bar{display:flex;gap:16px;align-items:center;padding:14px}
    .brand{color:var(--accent);font-weight:700;font-size:1.15rem;text-decoration:none}
    nav{margin-left:auto;display:flex;gap:10px}
    nav a{color:var(--muted);text-decoration:none;padding:8px;border-radius:8px}
    nav a:hover{color:#fff;background:rgba(255,255,255,0.02)}
    main{padding:18px}
    .panel{margin:22px 0;padding:18px;border-radius:var(--radius);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));}
    .card{background:var(--card);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
    .form-row{margin-bottom:12px;display:flex;flex-direction:column}
    input,textarea,select{background:var(--glass);border:1px solid rgba(255,255,255,0.03);color:#eaf1ff;padding:9px;border-radius:8px}
    .primary{background:linear-gradient(90deg,var(--accent),#8fb0ff);color:#07102a;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;text-decoration:none;display:inline-block}
    .ghost{background:transparent;color:var(--accent);padding:10px 12px;border-radius:10px;text-decoration:none;border:1px solid rgba(255,255,255,0.04);cursor:pointer;display:inline-block}
    .small{font-size:0.85rem;color:var(--muted)}
    .notice{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;color:var(--muted)}
    footer{padding:12px 0;border-top:1px solid rgba(255,255,255,0.02);color:var(--muted)}
    @media (max-width:720px){nav{display:none}}
  </style>
</head>
<body>
  <header>
    <div class="bar container">
      <a class="brand" href="#home">Reflectory</a>
      <nav>
        <a href="#home">Home</a>
        <a href="#about">About</a>
        <a href="#programs">Programs</a>
        <a href="#join">Join</a>
        <a href="#renew">Renew</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section id="home" class="panel">
      <h1>Reflectory</h1>
      <p class="small">Mentorship • Education • Guidance • Learning • AI-Assisted</p>
      <p class="small">A future where every student makes career and life decisions confidently and ethically.</p>
      <a class="primary" href="#join">Get Started</a>
    </section>

    <section id="about" class="panel">
      <h2>About</h2>
      <p class="small">Student-first mentorship foundation based in Palanpur, Gujarat. We combine human mentorship with AI-assisted planning.</p>
    </section>

    <section id="programs" class="panel">
      <h2>Programs</h2>
      <p class="small">Structured mentorship, habit building, human-verified AI roadmaps.</p>
    </section>

    <section id="join" class="panel">
      <h2>Join Reflectory</h2>
      <form id="joinForm" class="card" autocomplete="off">
        <div class="form-row"><label class="small">Name *</label><input name="name" required /></div>
        <div class="form-row"><label class="small">Email *</label><input name="email" type="email" required /></div>
        <div class="form-row"><label class="small">RCID (if you already have one)</label><input name="rcid" placeholder="Optional: RICD000123" /></div>
        <div class="form-row"><label class="small">Are you under 18?</label>
          <select name="is_minor"><option value="false">No</option><option value="true">Yes</option></select>
        </div>
        <div class="form-row"><label class="small">Parental consent given (if minor)</label>
          <select name="parental_consent_given"><option value="false">No</option><option value="true">Yes</option></select>
        </div>

        <div class="notice small">Consent & DPDP: By joining, you confirm you consent to Reflectory storing necessary data for mentorship. AI-assisted suggestions will be reviewed by a human mentor. For minors, parental consent must be provided.</div>

        <div class="form-row"><label><input type="checkbox" name="consent" required /> I consent to data usage (DPDP compliant)</label></div>
        <div class="form-row"><label><input type="checkbox" name="ai_ack" /> I acknowledge AI-assisted suggestions will be reviewed by a human.</label></div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="primary" type="submit">Submit Join Request</button>
          <a id="openJoinGoogle" class="ghost" target="_blank" rel="noopener">Open Google Join Form</a>
        </div>
        <div id="joinResult" class="small" style="margin-top:8px"></div>
        <div style="margin-top:8px"><button id="getRCID" type="button" class="ghost">Get or Create RCID for Email</button> <span id="rcidResult" class="small"></span></div>
      </form>
    </section>

    <section id="renew" class="panel">
      <h2>Renew Subscription (₹300 / month)</h2>
      <ol class="small">
        <li>Click "Pay with Razorpay" — opens in new tab.</li>
        <li>After paying, click "Verify Payment & Renewal" — opens Google Form in new tab and submit RCID & Transaction ID / Screenshot.</li>
        <li>Renewal is validated manually by admin.</li>
      </ol>

      <div class="card" style="margin-top:12px">
        <div class="small"><strong>Amount:</strong> ₹300 / month</div>
        <div style="margin-top:12px;display:flex;gap:8px;">
          <a id="payRazor" class="primary" target="_blank" rel="noopener">Pay with Razorpay</a>
          <a id="verifyForm" class="ghost" target="_blank" rel="noopener">Verify Payment & Renewal</a>
        </div>
        <div class="notice small" style="margin-top:12px">For offline/UPI payments, use admin-provided UPI details. After payment, submit the Google verification form (link above).</div>
      </div>
    </section>

    <section id="contact" class="panel">
      <h2>Contact</h2>
      <form id="contactForm" class="card" autocomplete="off">
        <div class="form-row"><label class="small">Name *</label><input name="name" required /></div>
        <div class="form-row"><label class="small">Email *</label><input name="email" type="email" required /></div>
        <div class="form-row"><label class="small">Message *</label><textarea name="message" rows="4" required></textarea></div>
        <div class="form-row"><label><input type="checkbox" name="consent" required /> I consent to Reflectory storing this message for response.</label></div>
        <div style="margin-top:8px"><button class="primary" type="submit">Send Message</button></div>
        <div id="contactResult" class="small" style="margin-top:8px"></div>
      </form>
    </section>

    <section id="legal" class="panel">
      <h2>Legal & Policies</h2>
      <p class="small">We follow India DPDP Act 2023. Grievance Officer: Karan Rajput — <a href="mailto:reflectory.in@gmail.com">reflectory.in@gmail.com</a>. Response window: 7 business days.</p>
      <div class="small">Links: Privacy Policy • Terms • Parental Consent • Refund Policy</div>
    </section>
  </main>

  <footer class="container">
    <div class="small">© Reflectory — Mentorship • Education • Guidance • Learning • AI-Assisted — MSME registered</div>
    <div class="small">Instagram: <a href="https://instagram.com/reflectory.in" target="_blank" rel="noopener">reflectory.in</a></div>
  </footer>

  <script>
    // Frontend logic: uses backend /site-config to get runtime links (Razorpay + Google forms)
    const qs = el => document.querySelector(el);
    let SITE = {
      RAZORPAY_LINK: '#',
      GOOGLE_RENEW_FORM: '#',
      GOOGLE_JOIN_FORM: '#'
    };

    async function loadConfig() {
      try {
        const r = await fetch('/site-config');
        if (r.ok) {
          const j = await r.json();
          SITE = Object.assign(SITE, j);
        }
      } catch (e) {
        console.warn('Could not load /site-config', e);
      }
      // apply links
      qs('#payRazor').href = SITE.RAZORPAY_LINK || '#';
      qs('#verifyForm').href = SITE.GOOGLE_RENEW_FORM || '#';
      qs('#openJoinGoogle').href = SITE.GOOGLE_JOIN_FORM || '#';
    }

    function showMsg(el, txt, ok=true) {
      el.textContent = txt;
      el.style.color = ok ? '#b6ffd9' : '#ffb6b6';
    }

    // Join form submit
    qs('#joinForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const f = e.target;
      const data = {
        name: f.name.value.trim(),
        email: f.email.value.trim(),
        rcid: f.rcid.value.trim() || undefined,
        is_minor: f.is_minor.value === 'true',
        parental_consent_given: f.parental_consent_given.value === 'true',
        consent_text: f.consent.checked ? true : false,
        ai_ack: f.ai_ack.checked ? true : false
      };
      const resEl = qs('#joinResult');
      try {
        const r = await fetch('/api/join', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
        const j = await r.json();
        if (r.ok && j.ok) {
          showMsg(resEl, `Join submitted. RCID: ${j.rcid || 'none'}. We will contact you by email.`, true);
          f.reset();
        } else {
          showMsg(resEl, j.error || 'Error submitting join', false);
        }
      } catch (err) {
        showMsg(resEl, 'Network error', false);
        console.error(err);
      }
    });

    // Get or create RCID by email
    qs('#getRCID').addEventListener('click', async () => {
      const email = prompt('Enter email to get or create RCID:');
      if (!email) return;
      const el = qs('#rcidResult');
      showMsg(el, 'Working...', true);
      try {
        const r = await fetch('/api/get-or-create-rcid', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email }) });
        const j = await r.json();
        if (r.ok && j.ok) {
          showMsg(el, `RCID: ${j.rcid} ${j.created ? '(newly created)' : '(existing)'}`, true);
        } else {
          showMsg(el, j.error || 'Error', false);
        }
      } catch (err) {
        showMsg(el, 'Network error', false);
      }
    });

    // Contact form
    qs('#contactForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const f = e.target;
      const data = { name:f.name.value.trim(), email:f.email.value.trim(), message:f.message.value.trim(), consent: f.consent.checked };
      const resEl = qs('#contactResult');
      if (!data.consent) {
        showMsg(resEl, 'Please give consent to store your message.', false); return;
      }
      try {
        const r = await fetch('/api/contact', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
        const j = await r.json();
        if (r.ok && j.ok) {
          showMsg(resEl, 'Message sent. We will reach out to you soon.', true);
          f.reset();
        } else showMsg(resEl, j.error || 'Error sending', false);
      } catch (err) {
        showMsg(resEl, 'Network error', false);
      }
    });

    window.addEventListener('load', () => {
      loadConfig();
      // Anchor smooth scroll
      document.querySelectorAll('a[href^="#"]').forEach(a=>{
        a.addEventListener('click', (ev) => {
          ev.preventDefault();
          const id = a.getAttribute('href').slice(1);
          const el = document.getElementById(id);
          if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      });
    });
  </script>
</body>
</html>
